#!/usr/bin/python3
"""
################################################################################
This script checks for CVE-2017-9248
https://nvd.nist.gov/vuln/detail/CVE-2017-9248
Telerik Web UI's Cryptographic Weakness
################################################################################
"""

import sys
import requests

indicator="Telerik.Web.UI%2c+Version%3d"
vulnerable_versions=["2007.1423","2008.31314","2010.31317","2013.1.403",
"2015.2.729","2007.1521","2009.1311","2011.1315","2013.1.417","2015.2.826",
"2007.1626","2009.1402","2011.1413","2013.2.611","2015.3.930","2007.2918",
"2009.1527","2011.1519","2013.2.717","2015.3.1111","2007.2101","2009.2701",
"2011.2712","2013.3.1015","2016.1.113","2007.21107","2009.2826","2011.2915",
"2013.3.1114","2016.1.225","2007.31218","2009.31103","2011.31115","2013.3.1324",
"2016.2.504","2007.31314","2009.31208","2011.3.1305","2014.1.225","2016.2.607",
"2007.31425","2009.31314","2012.1.215","2014.1.403","2016.3.914","2008.1415",
"2010.1309","2012.1.411","2014.2.618","2016.3.1018","2008.1515","2010.1415",
"2012.2.607","2014.2.724","2016.3.1027","2008.1619","2010.1519","2012.2.724",
"2014.3.1024","2017.1.118","2008.2723","2010.2713","2012.2.912","2015.1.204",
"2017.1.228","2008.2826","2010.2826","2012.3.1016","2015.1.225","2017.2.503",
"2008.21001","2010.2929","2012.3.1205","2015.1.401","2017.2.621","2008.31105",
"2010.31109","2012.3.1308","2015.2.604","2017.2.711","2008.31125","2010.31215",
"2013.1.220","2015.2.623","2017.3.913"]
body_message="<div style='text-align:center;'>Loading the dialog...</div>"
dialog_handler='Telerik.Web.UI.DialogHandler.aspx'

url = str(sys.argv[1])
initial = requests.get(url)
initial_result = initial.text
handler = requests.get(url+dialog_handler)
handler_result=handler.text

if indicator in initial_result:
  for x in vulnerable_versions:
    if indicator+x in initial_result:
      print("Version", x, "found")

if body_message in handler_result:
  print("[+]POSSIBLE VULNERABLE")
else:
  print(dialog_handler, "not found")


################################################################################
### TODO: Implement the gadget to exploit                                    ###
################################################################################